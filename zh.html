<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrderEase - å°ˆæ¥­é›²ç«¯æ¥å–®ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        #header-bar { position: sticky; top: 0; z-index: 50; background: #1e293b; color: white; padding: 1.25rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .menu-card { background: white; border-radius: 1rem; padding: 1.25rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .item-qty { width: 4.5rem; height: 3rem; font-size: 1.5rem; border: 2px solid #cbd5e1; border-radius: 0.5rem; text-align: center; }
        .btn-submit { background-color: #059669; color: white; padding: 1.25rem; width: 100%; border-radius: 0.75rem; font-weight: bold; font-size: 1.5rem; margin-top: 2rem; transition: background 0.2s; }
        .btn-submit:active { background-color: #047857; transform: scale(0.98); }
    </script>
</head>
<body class="pb-10">

    <div id="header-bar" class="flex justify-between items-center">
        <div>
            <p class="text-xs text-slate-400 uppercase tracking-wider">ä»Šæ—¥æ¥å–®å–®è™Ÿ</p>
            <p id="header-num" class="text-3xl font-black text-emerald-400">æ­£åœ¨ç”Ÿæˆ...</p>
        </div>
        <button onclick="location.reload()" class="bg-slate-700 px-4 py-2 rounded-lg text-sm font-medium">é‡æ•´é é¢</button>
    </div>

    <div class="p-4 max-w-md mx-auto">
        <div class="menu-card flex justify-between items-center">
            <div class="flex-1">
                <h3 class="text-xl font-bold text-slate-800">ç´…ç‡’ç‰›è‚‰éºµ</h3>
                <p class="text-emerald-600 font-bold">$150</p>
            </div>
            <input type="number" class="item-qty" data-name="ç´…ç‡’ç‰›è‚‰éºµ" data-price="150" value="0" min="0">
        </div>

        <div class="menu-card flex justify-between items-center">
            <div class="flex-1">
                <h3 class="text-xl font-bold text-slate-800">æ¸…ç‡‰ç‰›è‚‰éºµ</h3>
                <p class="text-emerald-600 font-bold">$150</p>
            </div>
            <input type="number" class="item-qty" data-name="æ¸…ç‡‰ç‰›è‚‰éºµ" data-price="150" value="0" min="0">
        </div>

        <div class="menu-card flex justify-between items-center">
            <div class="flex-1">
                <h3 class="text-xl font-bold text-slate-800">æ»·è›‹ (é¡†)</h3>
                <p class="text-emerald-600 font-bold">$15</p>
            </div>
            <input type="number" class="item-qty" data-name="æ»·è›‹(é¡†)" data-price="15" value="0" min="0">
        </div>

        <button onclick="submitOrder()" class="btn-submit shadow-lg">ç¢ºèªé€å‡ºè¨‚å–®</button>
    </div>

    <script>
        // ã€é‡è¦ã€‘å·²å¡«å…¥ç¬¬ 10 ç‰ˆæ­£ç¢º Web App URL
        const scriptURL = 'https://script.google.com/macros/s/AKfycbys5EEI2YgAPL5YXRbqdedZ_ajf1VWU2ACNN861AqE4n6egJ1-A1a1wZBm9IZyIWp0m/exec';

        // è‡ªå‹•ç”Ÿæˆå–®è™Ÿ (æ™‚åˆ†-éš¨æ©Ÿæ•¸)
        function generateOrderNum() {
            const now = new Date();
            const timePart = now.getHours().toString().padStart(2,'0') + now.getMinutes().toString().padStart(2,'0');
            const randomPart = Math.floor(Math.random() * 9000 + 1000);
            return `${timePart}-${randomPart}`;
        }

        const currentOrderId = generateOrderNum();
        document.getElementById('header-num').innerText = currentOrderId;

        async function submitOrder() {
            const items = [];
            let total = 0;

            document.querySelectorAll('.item-qty').forEach(input => {
                const qty = parseInt(input.value);
                if (qty > 0) {
                    const name = input.getAttribute('data-name');
                    const price = parseInt(input.getAttribute('data-price'));
                    items.push(`${name} x${qty}`);
                    total += price * qty;
                }
            });

            if (items.length === 0) {
                alert("âŒ è«‹å…ˆé»é¤ï¼");
                return;
            }

            const btn = document.querySelector('.btn-submit');
            btn.innerText = "ğŸš€ è¨‚å–®å‚³é€ä¸­...";
            btn.disabled = true;

            try {
                // å‚³é€è³‡æ–™åˆ° Google è©¦ç®—è¡¨
                await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        orderId: currentOrderId,
                        items: items.join('\n'),
                        total: total
                    })
                });

                alert("âœ… è¨‚å–®å·²æˆåŠŸé€é”ï¼");
                location.reload(); // æˆåŠŸå¾Œè‡ªå‹•åˆ·æ–°ï¼Œç¢ºä¿å–®è™Ÿä¸é‡è¤‡
            } catch (error) {
                alert("âš ï¸ å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šï¼");
                btn.innerText = "é‡æ–°é€å‡ºè¨‚å–®";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>