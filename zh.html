<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雲端點餐系統 - 專業版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --primary-blue: #1a237e; }
        body { font-family: sans-serif; background-color: #f4f7f6; }
        #sticky-header { position: sticky; top: 0; z-index: 50; background: var(--primary-blue); color: white; padding: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .menu-item { background: white; border-bottom: 1px solid #eee; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .qty-input { width: 60px; border: 1px solid #ccc; border-radius: 4px; padding: 5px; text-align: center; font-size: 1.2rem; }
        .btn-submit { background-color: #2e7d32; color: white; padding: 1rem; width: 100%; font-weight: bold; font-size: 1.3rem; margin-top: 2rem; border-radius: 8px; }
    </style>
</head>
<body>

    <div id="sticky-header" class="flex justify-between items-center">
        <div>
            <span class="text-sm opacity-80">今日單號：</span>
            <span id="order-id-display" class="text-xl font-bold">生成中...</span>
        </div>
        <button onclick="location.reload()" class="bg-blue-800 px-3 py-1 rounded text-xs">重整</button>
    </div>

    <div class="max-w-md mx-auto">
        <div class="menu-item">
            <div><h3 class="font-bold">紅燒牛肉麵</h3><p class="text-gray-500">$150</p></div>
            <input type="number" class="qty-input" data-name="紅燒牛肉麵" data-price="150" value="0" min="0">
        </div>

        <div class="menu-item">
            <div><h3 class="font-bold">清燉牛肉麵</h3><p class="text-gray-500">$150</p></div>
            <input type="number" class="qty-input" data-name="清燉牛肉麵" data-price="150" value="0" min="0">
        </div>

        <div class="menu-item">
            <div><h3 class="font-bold">酸辣湯</h3><p class="text-gray-500">$40</p></div>
            <input type="number" class="qty-input" data-name="酸辣湯" data-price="40" value="0" min="0">
        </div>

        <div class="p-4">
            <button onclick="submitOrder()" class="btn-submit">確認送出訂單</button>
        </div>
    </div>

    <script>
        // 【正確網址】對照 image_75d7df.jpg 抓取，確保連接第 10 版
        const scriptURL = 'https://script.google.com/macros/s/AKfycbys5EEI2YgAPL5YXRbqdedZ_ajf1VWU2ACNN861AqE4n6egJ1-A1a1wZBm9IZyIWp0m/exec';

        const currentId = "ID-" + Math.floor(Math.random() * 9000 + 1000);
        document.getElementById('order-id-display').innerText = currentId;

        async function submitOrder() {
            const items = [];
            let total = 0;
            document.querySelectorAll('.qty-input').forEach(input => {
                const qty = parseInt(input.value);
                if (qty > 0) {
                    items.push(input.getAttribute('data-name') + " x" + qty);
                    total += qty * parseInt(input.getAttribute('data-price'));
                }
            });

            if (items.length === 0) return alert("請先選擇餐點");

            const btn = document.querySelector('.btn-submit');
            btn.disabled = true;
            btn.innerText = "傳送中...";

            try {
                // 發送到 Apps Script 第 10 版
                await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({
                        orderId: currentId,
                        items: items.join('\n'),
                        total: total
                    })
                });
                alert("訂單已送出！");
                location.reload();
            } catch (e) {
                alert("網路異常，請重試");
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>