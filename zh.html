<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é»æ˜“ OrderEase - ç‰›è‚‰éºµæ­£å¼ç‰ˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: "Noto Sans TC", sans-serif; background-color: #2d1f18; min-height: 100vh; padding-bottom: 50px; }
    #sticky-order-bar { position: fixed; top: 0; width: 100%; background: #4a3528; color: #fff; text-align: center; padding: 10px; font-weight: bold; z-index: 9999; border-bottom: 2px solid #ff6d00; }
    .menu-card { background: #f5e6d3; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
  </style>
</head>

<body class="antialiased">
  <div id="sticky-order-bar">æ‚¨çš„å–®è™Ÿï¼š<span id="header-num" style="color:#ff6d00;">ç­‰å¾…ä¸‹å–®...</span></div>

  <div class="max-w-md mx-auto px-4 py-16">
    <header class="bg-white rounded-2xl p-6 mb-6 text-center shadow-lg">
      <div class="font-bold text-2xl">
        <span style="color:#1a237e;">OrderEase</span><span style="color:#ff6d00;">é»æ˜“</span>
      </div>
    </header>

    <main class="menu-card p-6">
      <div class="bg-white/80 p-4 rounded-xl border-2 border-orange-200 mb-6 shadow-inner text-center">
        <input type="text" id="table-number" placeholder="ğŸ“ æ¡Œè™Ÿ (å…§ç”¨è«‹å¡«å¯«)" class="w-full p-2 rounded-lg border-2 border-gray-200 focus:border-orange-500 text-center text-lg font-bold">
      </div>

      <!-- âœ… èœå–®æœƒæ¸²æŸ“åœ¨é€™è£¡ -->
      <div id="menu-container" class="space-y-4"></div>

      <div class="border-t-2 border-orange-200 pt-6 mt-8 text-center">
        <div class="flex justify-between items-center mb-6 px-4">
          <span class="font-bold text-gray-600">ç¸½é‡‘é¡</span>
          <span id="total-price" class="text-3xl font-bold text-orange-600">$0</span>
        </div>
        <button id="submit-btn" class="w-full bg-orange-600 text-white font-bold py-5 rounded-2xl shadow-xl text-xl">ç¢ºèªé€å‡ºè¨‚å–®</button>
      </div>
    </main>
  </div>

  <script>
    // âœ… æ›æˆä½ è‡ªå·±çš„ GAS Web App URL
    const scriptURL = 'è«‹è²¼ä¸Šä½ çš„scriptURL';

    const menuItems = [
      { id: "n1", zh: "ç´…ç‡’ç‰›è‚‰éºµ", price: 150 },
      { id: "n2", zh: "æ¸…ç‡‰ç‰›è‚‰éºµ", price: 150 },
      { id: "n3", zh: "ç‰›è‚‰æ¹¯é¤ƒ",   price: 120 },
      { id: "s1", zh: "æ»·å‘³æ‹¼ç›¤",   price: 60  },
      { id: "s2", zh: "é…¸è¾£æ¹¯",     price: 40  },
      { id: "s3", zh: "æ»·è›‹ (é¡†)",  price: 15  }
    ];

    const cart = {};

    function renderMenu() {
      const container = document.getElementById("menu-container");
      if (!container) {
        alert("æ‰¾ä¸åˆ° menu-containerï¼ŒHTML çµæ§‹æœ‰å•é¡Œ");
        return;
      }

      container.innerHTML = "";

      menuItems.forEach(item => {
        if (cart[item.id] === undefined) cart[item.id] = 0;

        const row = document.createElement("div");
        row.className = "flex items-center justify-between p-2";

        row.innerHTML = `
          <div>
            <b class="text-slate-800 text-lg">${item.zh}</b><br>
            <span class="text-orange-600 font-bold">$${item.price}</span>
          </div>
          <div class="flex items-center gap-4">
            <button class="w-10 h-10 rounded-full border-2 border-blue-800 text-blue-800 font-bold text-xl" data-id="${item.id}" data-change="-1">-</button>
            <span id="qty-${item.id}" class="font-bold text-xl w-6 text-center">${cart[item.id]}</span>
            <button class="w-10 h-10 rounded-full border-2 border-blue-800 text-blue-800 font-bold text-xl" data-id="${item.id}" data-change="1">+</button>
          </div>
        `;
        container.appendChild(row);
      });
    }

    function updateQty(id, change) {
      cart[id] = Math.max(0, (cart[id] || 0) + change);
      const qtyEl = document.getElementById(`qty-${id}`);
      if (qtyEl) qtyEl.innerText = cart[id];

      let total = 0;
      menuItems.forEach(item => total += (cart[item.id] || 0) * item.price);
      document.getElementById("total-price").innerText = `$${total}`;
    }

    async function submitToSpreadsheet() {
      const tableNum = document.getElementById("table-number").value.trim() || "å¤–å¸¶";

      let rawItems = [];
      let total = 0;
      menuItems.forEach(item => {
        if ((cart[item.id] || 0) > 0) {
          rawItems.push(`${item.zh} x${cart[item.id]}`);
          total += cart[item.id] * item.price;
        }
      });

      if (total === 0) return alert("è«‹å…ˆé¸æ“‡é¤é»ï¼");

      const btn = document.getElementById("submit-btn");
      btn.innerText = "âš¡ å‚³é€ä¸­...";
      btn.disabled = true;

      try {
        const response = await fetch(scriptURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ tableNumber: tableNum, items: rawItems.join("\n"), total })
        });

        const result = await response.json();

        if (result.orderId) {
          document.getElementById("header-num").innerText = result.orderId;
          alert("âœ… è¨‚å–®æˆåŠŸï¼æ‚¨çš„å–®è™Ÿæ˜¯ï¼š" + result.orderId);

          // æ¸…ç©º
          menuItems.forEach(item => {
            cart[item.id] = 0;
            const q = document.getElementById(`qty-${item.id}`);
            if (q) q.innerText = "0";
          });
          document.getElementById("total-price").innerText = "$0";
          document.getElementById("table-number").value = "";

          setTimeout(() => {
            document.getElementById("header-num").innerText = "ç­‰å¾…ä¸‹å–®...";
          }, 8000);
        } else {
          alert("å›å‚³æ²’æœ‰ orderIdï¼Œè«‹æª¢æŸ¥ GAS");
        }
      } catch (e) {
        alert("é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ scriptURL / æ¬Šé™ / éƒ¨ç½²");
      } finally {
        btn.innerText = "ç¢ºèªé€å‡ºè¨‚å–®";
        btn.disabled = false;
      }
    }

    // âœ… é€™ç¨®åˆå§‹åŒ–æœ€ç©©ï¼šä¿è­‰ DOM å‡ºä¾†æ‰æ¸²æŸ“èœå–®
    document.addEventListener("DOMContentLoaded", () => {
      renderMenu();

      // ç”¨äº‹ä»¶ä»£ç†ï¼Œé¿å… inline onclick å‡ºéŒ¯å°è‡´æ•´é ä¸æ¸²æŸ“
      document.body.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-id]");
        if (!btn) return;
        const id = btn.getAttribute("data-id");
        const change = parseInt(btn.getAttribute("data-change"), 10);
        updateQty(id, change);
      });

      document.getElementById("submit-btn").addEventListener("click", submitToSpreadsheet);
    });
  </script>
</body>
</html>
