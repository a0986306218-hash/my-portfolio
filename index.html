<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>OrderEase é»æ˜“ - ç‰›è‚‰éºµ</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{--blue:#1a237e;--orange:#ff6d00;}
body{font-family:"Noto Sans TC",sans-serif;background:linear-gradient(135deg,#4a3528 0%,#2d1f18 100%);min-height:100vh;padding-bottom:60px;}
#sticky{position:fixed;top:0;left:0;right:0;background:rgba(45,31,24,.95);color:#f5e6d3;text-align:center;padding:12px;font-weight:700;z-index:9999;border-bottom:2px solid var(--orange);display:none;}
.card{background:rgba(245,230,211,.98);border:1px solid #c4a574;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,.3);}
.pagerBtn{width:44px;height:44px;border-radius:999px;border:2px solid var(--blue);color:var(--blue);font-weight:900;font-size:22px;display:flex;align-items:center;justify-content:center;}
.pagerBtn:active{transform:scale(.96);}
</style>
</head>

<body class="antialiased">
<div id="sticky">
  <span id="t_orderid">æ‚¨çš„å–®è™Ÿï¼š</span><span id="orderNum" style="color:var(--orange);"></span>
  <button id="btnNew" class="ml-3 text-xs bg-red-700 text-white px-2 py-1 rounded" onclick="newCustomer()">æ–°é¡§å®¢/çµå¸³</button>
</div>

<div class="max-w-md mx-auto px-4 py-6">
  <header class="bg-white rounded-2xl p-6 mb-6 text-center shadow-lg">
    <div class="flex items-center justify-center gap-3 mb-4">
      <div style="background:var(--blue);width:35px;height:35px;border-radius:8px;display:flex;align-items:center;justify-content:center;position:relative;">
        <span style="color:#fff;font-size:20px;">âœ”</span>
        <div style="position:absolute;top:-2px;right:-2px;background:var(--orange);width:12px;height:12px;border-radius:50%;border:2px solid #fff;"></div>
      </div>
      <div class="font-bold text-2xl"><span style="color:var(--blue);">OrderEase</span><span style="color:var(--orange);">é»æ˜“</span></div>
    </div>

    <div class="inline-flex bg-gray-100 rounded-full p-1 text-xs">
      <button id="btnEn" class="px-4 py-2 rounded-full text-gray-500" onclick="setLang('en')">English</button>
      <button id="btnZh" class="px-4 py-2 rounded-full bg-blue-700 text-white" onclick="setLang('zh')">ä¸­æ–‡</button>
    </div>
  </header>

  <main class="card p-4 space-y-4">
    <div class="bg-white/50 p-3 rounded-xl border border-orange-200">
      <label id="t_table" class="block text-sm font-bold mb-1">ğŸ“ æ¡Œè™Ÿ (å…§ç”¨è«‹å¡«å¯«)ï¼š</label>
      <input id="table" class="w-full p-2 rounded-lg border border-gray-300 focus:outline-none" placeholder="ä¾‹å¦‚ï¼šA1">
    </div>

    <div class="flex items-center justify-between">
      <div class="font-bold text-slate-700" id="t_menu">èœå–®</div>
      <div class="flex items-center gap-2">
        <button class="pagerBtn" id="prevBtn" onclick="prevPage()">â€¹</button>
        <div class="text-xs text-slate-600 font-bold" id="pageInfo"></div>
        <button class="pagerBtn" id="nextBtn" onclick="nextPage()">â€º</button>
      </div>
    </div>

    <div id="menu" class="space-y-3"></div>

    <div class="border-t-2 border-gray-200 pt-4 mt-2">
      <div class="flex justify-between items-center mb-4">
        <span id="t_total" class="font-bold text-gray-600">ç¸½é‡‘é¡</span>
        <span id="total" class="text-2xl font-bold text-orange-600">$0</span>
      </div>
      <button id="submit" class="w-full bg-orange-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition" onclick="submitOrder()">ç¢ºèªé€å‡ºè¨‚å–®</button>
    </div>
  </main>
</div>

<script>
const scriptURL="https://script.google.com/macros/s/AKfycby5EEI2YgAPL5YXRbqdedZ_eJf1VWU2ACNn861AqE4n6egJ1-A1a1wZBm9lZyinh_k/exec";

const menuItems=[
  {id:"n1",zh:"ç´…ç‡’ç‰›è‚‰éºµ",en:"Braised Beef Noodles",price:150},
  {id:"n2",zh:"æ¸…ç‡‰ç‰›è‚‰éºµ",en:"Clear Broth Beef Noodles",price:150},
  {id:"n3",zh:"ç‰›è‚‰æ¹¯é¤ƒ",en:"Beef Soup Dumplings",price:120},
  {id:"s1",zh:"æ»·å‘³æ‹¼ç›¤",en:"Signature Braised Platter",price:60},
  {id:"s2",zh:"é…¸è¾£æ¹¯",en:"Hot and Sour Soup",price:40},
  {id:"s3",zh:"æ»·è›‹ (é¡†)",en:"Marinated Egg (pc)",price:15},
  // ä½ ä»¥å¾ŒåŠ å“é …å°±åªåŠ é€™è£¡ï¼Œä¸å‹•å…¶ä»–ç¨‹å¼
];

let lang=localStorage.getItem("lang")||"zh";
let cart={};
let orderId=localStorage.getItem("orderId")||"";
let page=0;
const perPage=6;

const T={
  zh:{orderid:"æ‚¨çš„å–®è™Ÿï¼š",newbtn:"æ–°é¡§å®¢/çµå¸³",table:"ğŸ“ æ¡Œè™Ÿ (å…§ç”¨è«‹å¡«å¯«)ï¼š",ph:"ä¾‹å¦‚ï¼šA1",menu:"èœå–®",total:"ç¸½é‡‘é¡",send:"ç¢ºèªé€å‡ºè¨‚å–®",sending:"âš¡ å‚³é€ä¸­...",need:"è«‹å…ˆé¸æ“‡é¤é»ï¼",ok:"âœ… è¨‚å–®æˆåŠŸï¼å–®è™Ÿï¼š",clear:"æ¸…é™¤å–®è™Ÿä¸¦é‡æ–°é»é¤å—ï¼Ÿ"},
  en:{orderid:"Order ID: ",newbtn:"New Customer",table:"ğŸ“ Table No. (Dine-in):",ph:"e.g., A1",menu:"Menu",total:"Total",send:"Send Order",sending:"âš¡ Sending...",need:"Please select items!",ok:"âœ… Order Sent! ID: ",clear:"Clear order ID and start over?"}
};

function setLang(x){
  lang=x; localStorage.setItem("lang",lang);
  document.getElementById("btnEn").className=lang==="en"?"px-4 py-2 rounded-full bg-blue-700 text-white":"px-4 py-2 rounded-full text-gray-500";
  document.getElementById("btnZh").className=lang==="zh"?"px-4 py-2 rounded-full bg-blue-700 text-white":"px-4 py-2 rounded-full text-gray-500";
  applyText(); renderMenu();
}

function applyText(){
  const t=T[lang];
  document.getElementById("t_orderid").innerText=t.orderid;
  document.getElementById("btnNew").innerText=t.newbtn;
  document.getElementById("t_table").innerText=t.table;
  document.getElementById("table").placeholder=t.ph;
  document.getElementById("t_menu").innerText=t.menu;
  document.getElementById("t_total").innerText=t.total;
  document.getElementById("submit").innerText=t.send;
}

function showSticky(){
  document.getElementById("orderNum").innerText=orderId;
  document.getElementById("sticky").style.display="block";
  document.body.style.paddingTop="60px";
}

function newCustomer(){
  if(confirm(T[lang].clear)){
    localStorage.removeItem("orderId");
    location.reload();
  }
}

function renderMenu(){
  const start=page*perPage;
  const slice=menuItems.slice(start,start+perPage);

  const menu=document.getElementById("menu");
  menu.innerHTML="";
  slice.forEach(item=>{
    if(cart[item.id]===undefined) cart[item.id]=0;
    const name = (lang === "en" && item.en) ? item.en : item.zh;
    menu.innerHTML+=`
      <div class="flex items-center justify-between p-2 border-b border-gray-100">
        <div>
          <b class="text-slate-800">${name}</b><br>
          <span class="text-orange-600 font-bold">$${item.price}</span>
        </div>
        <div class="flex items-center gap-3">
          <button class="w-8 h-8 rounded-full border border-blue-800 text-blue-800 font-bold" onclick="qty('${item.id}',-1)">-</button>
          <span class="font-bold w-5 text-center" id="q_${item.id}">${cart[item.id]}</span>
          <button class="w-8 h-8 rounded-full border border-blue-800 text-blue-800 font-bold" onclick="qty('${item.id}',1)">+</button>
        </div>
      </div>
    `;
  });

  const totalPages=Math.max(1,Math.ceil(menuItems.length/perPage));
  document.getElementById("pageInfo").innerText=`${page+1}/${totalPages}`;

  // å·¦å³ç®­é ­è¦å‰‡
  document.getElementById("prevBtn").style.visibility=(page===0)?"hidden":"visible";
  const nextBtn=document.getElementById("nextBtn");
  if(page===totalPages-1){
    nextBtn.innerText="â€¹";          // ä½ è¦çš„ï¼šç¿»åˆ°åº•ç®­é ­è®Šå¾€å·¦
  }else{
    nextBtn.innerText="â€º";
  }
}

function prevPage(){ if(page>0){ page--; renderMenu(); } }
function nextPage(){
  const totalPages=Math.max(1,Math.ceil(menuItems.length/perPage));
  if(page===totalPages-1){
    page=0; // æœ€å¾Œä¸€é ï¼ŒæŒ‰å³é‚Šï¼ˆå·²è®Šå·¦ç®­é ­ï¼‰å›åˆ°ç¬¬ä¸€é 
  }else{
    page++;
  }
  renderMenu();
}

function qty(id,delta){
  cart[id]=Math.max(0,(cart[id]||0)+delta);
  const el=document.getElementById("q_"+id);
  if(el) el.innerText=cart[id];

  let sum=0;
  menuItems.forEach(it=>sum+=(cart[it.id]||0)*it.price);
  document.getElementById("total").innerText=`$${sum}`;
}

async function submitOrder(){
  const t=T[lang];
  const table=(document.getElementById("table").value.trim())||"å¤–å¸¶";

  let lines=[];
  let total=0;
  menuItems.forEach(it=>{
    const q=cart[it.id]||0;
    if(q>0){
      lines.push(`${it.zh} x${q}`);  // âœ… æ°¸é é€ä¸­æ–‡
      total+=q*it.price;
    }
  });
  if(total===0){ alert(t.need); return; }

  if(!orderId){
    const d=new Date();
    const rp=Math.floor(Math.random()*9000+1000);
    orderId=`${String(d.getMonth()+1).padStart(2,"0")}${String(d.getDate()).padStart(2,"0")}-${rp}`;
    localStorage.setItem("orderId",orderId);
  }

  const btn=document.getElementById("submit");
  btn.innerText=t.sending; btn.disabled=true;

  try{
    await fetch(scriptURL,{method:"POST",mode:"no-cors",body:JSON.stringify({
      orderId:orderId,
      tableNumber:table,
      items:lines.join("\n"),
      total:total
    })});
    alert(t.ok+orderId);
    showSticky();

    // æ¸…ç©ºè³¼ç‰©è»Š
    Object.keys(cart).forEach(k=>cart[k]=0);
    document.getElementById("total").innerText="$0";
    document.getElementById("table").value="";
    renderMenu();
  }catch(e){
    alert("é€å‡ºå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Apps Script éƒ¨ç½²æ¬Šé™");
  }finally{
    btn.innerText=t.send; btn.disabled=false;
  }
}

window.onload=function(){
  applyText();
  setLang(lang);
  renderMenu();
  if(orderId){ showSticky(); }
};
</script>
</body>
</html>
