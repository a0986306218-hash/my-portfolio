<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é»æ˜“ - é¹¹é…¥é›æ¨£æ¿æ©Ÿ</title>
    <style>
        body { font-family: sans-serif; background-color: #3e2723; color: #fff; margin: 0; padding: 15px; }
        .card { background: #fff; color: #333; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        h1 { color: #d84315; text-align: center; margin-top: 0; }
        .menu-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 12px 0; }
        .add-btn { background: #d84315; color: white; border: none; padding: 8px 18px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        
        /* æ¡Œè™Ÿå€å¡Š */
        .table-section { background: #fff3e0; padding: 15px; border-radius: 10px; margin: 20px 0; border: 1px solid #ffb74d; }
        .table-input { width: 100%; padding: 12px; font-size: 18px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }

        /* å½ˆå‡ºé¸å–® (Modal) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; }
        .modal-content { background: #fff; color: #333; width: 85%; max-width: 400px; margin: 25% auto; padding: 25px; border-radius: 15px; }
        .option-group { margin: 15px 0; }
        .option-btn { display: inline-block; background: #eee; padding: 10px 15px; margin: 5px; border-radius: 20px; cursor: pointer; font-size: 14px; }
        .option-btn.active { background: #d84315; color: #fff; }

        .submit-btn { background: #d84315; color: #fff; width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 20px; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .submit-btn:disabled { background: #ccc; }
    </style>
</head>
<body>

<div class="card">
    <h1>ğŸ”¥ é˜¿è±ªé¹¹é…¥é› ğŸ”¥</h1>
    
    <div class="table-section">
        <label style="color: #d84315; font-weight: bold; display: block; margin-bottom: 8px;">ğŸ“ è«‹è¼¸å…¥æ¡Œè™Ÿæˆ–å–é¤ç¨±å‘¼ï¼š</label>
        <input type="text" id="tableNum" class="table-input" placeholder="ä¾‹å¦‚ï¼š3 è™Ÿæ¡Œ æˆ– é™³å…ˆç”Ÿ">
    </div>

    <div id="menu">
        </div>

    <div style="margin-top:20px; border-top: 2px solid #eee; padding-top:15px;">
        <h3 style="margin-bottom:10px;">å·²é¸é¤é»ï¼š</h3>
        <div id="cartDisplay" style="color: #666; font-size: 15px; line-height: 1.6;"></div>
        <h2 style="text-align: right; color: #d84315; margin-top: 15px;">ç¸½è¨ˆï¼š$<span id="totalPrice">0</span></h2>
    </div>

    <button class="submit-btn" id="sendBtn" onclick="sendOrder()">ç¢ºèªé€å‡ºè¨‚å–®</button>
</div>

<div id="optionModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle" style="margin-top:0; color:#d84315;">å®¢è£½åŒ–éœ€æ±‚</h3>
        <div class="option-group">
            <strong>é¸æ“‡è¾£åº¦ï¼š</strong><br>
            <div id="spicyOptions">
                <span class="option-btn active" onclick="setSpicy('ä¸è¾£', this)">ä¸è¾£</span>
                <span class="option-btn" onclick="setSpicy('å°è¾£', this)">å°è¾£</span>
                <span class="option-btn" onclick="setSpicy('ä¸­è¾£', this)">ä¸­è¾£</span>
                <span class="option-btn" onclick="setSpicy('å¤§è¾£', this)">å¤§è¾£</span>
            </div>
        </div>
        <div class="option-group">
            <strong>åŠ è³¼é…æ–™ (å¯å¤šé¸)ï¼š</strong><br>
            <div id="toppingOptions">
                <span class="option-btn" onclick="toggleTopping('åŠ è’œ', this)">åŠ è’œ</span>
                <span class="option-btn" onclick="toggleTopping('åŠ ä¹å±¤å¡”', this)">åŠ ä¹å±¤å¡”</span>
            </div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="submit-btn" style="background:#888;" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="submit-btn" onclick="confirmItem()">åŠ å…¥æ¸…å–®</button>
        </div>
    </div>
</div>

<script>
    // è‡ªå‹•å¸¶å…¥ä½ æä¾›çš„ç¶²å€
    const scriptURL = 'https://script.google.com/macros/s/AKfycbx4_Q--hhZdMO0qqGcN91juSZMyhoqw_X6MIcfLrkFCcsyk2j1Gdgzf4cmMuZMEkG4U/exec';
    
    const menu = [
        { name: 'æ‹›ç‰Œé¹¹é…¥é›', price: 60 }, 
        { name: 'é…¥ç‚¸é­·é­š', price: 60 }, 
        { name: 'æ‰‹å·¥ç”œä¸è¾£', price: 30 },
        { name: 'å››å­£è±†', price: 40 },
        { name: 'ç±³è¡€ç³•', price: 25 }
    ];

    let cart = [];
    let currentItem = null;
    let currentSpicy = 'ä¸è¾£';
    let currentToppings = [];

    // ç”¢ç”Ÿèœå–®
    const menuDiv = document.getElementById('menu');
    menu.forEach(item => {
        menuDiv.innerHTML += `
            <div class="menu-item">
                <span><strong>${item.name}</strong> - $${item.price}</span>
                <button class="add-btn" onclick="openOptions('${item.name}', ${item.price})">åŠ å…¥</button>
            </div>`;
    });

    function openOptions(name, price) {
        currentItem = { name, price };
        currentSpicy = 'ä¸è¾£';
        currentToppings = [];
        // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('#spicyOptions .option-btn').classList.add('active');
        document.getElementById('modalTitle').innerText = 'å®¢è£½åŒ–ï¼š' + name;
        document.getElementById('optionModal').style.display = 'block';
    }

    function closeModal() { document.getElementById('optionModal').style.display = 'none'; }

    function setSpicy(val, el) {
        currentSpicy = val;
        document.querySelectorAll('#spicyOptions .option-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
    }

    function toggleTopping(val, el) {
        if (currentToppings.includes(val)) {
            currentToppings = currentToppings.filter(t => t !== val);
            el.classList.remove('active');
        } else {
            currentToppings.push(val);
            el.classList.add('active');
        }
    }

    function confirmItem() {
        const toppingText = currentToppings.length > 0 ? `/ ${currentToppings.join(',')}` : '';
        const fullInfo = `${currentItem.name} (${currentSpicy}${toppingText})`;
        cart.push({ name: fullInfo, price: currentItem.price });
        updateCart();
        closeModal();
    }

    function updateCart() {
        const cartDiv = document.getElementById('cartDisplay');
        const totalSpan = document.getElementById('totalPrice');
        cartDiv.innerHTML = cart.map((i, index) => `
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span>${i.name}</span>
                <span>$${i.price} <small style="cursor:pointer; color:red;" onclick="removeItem(${index})">âœ•</small></span>
            </div>`).join('');
        totalSpan.innerText = cart.reduce((sum, i) => sum + i.price, 0);
    }

    function removeItem(idx) { cart.splice(idx, 1); updateCart(); }

    function sendOrder() {
        const table = document.getElementById('tableNum').value;
        const sendBtn = document.getElementById('sendBtn');
        if (!table) return alert('è«‹è¼¸å…¥æ¡Œè™Ÿæˆ–ç¨±å‘¼ï¼Œæ–¹ä¾¿è€é—†é€é¤å–”ï¼');
        if (cart.length === 0) return alert('æ¸…å–®é‚„æ˜¯ç©ºçš„å–”ï¼');

        sendBtn.disabled = true;
        sendBtn.innerText = 'è¨‚å–®å‚³é€ä¸­...';

        const orderData = {
            tableNumber: table,
            items: cart.map(i => i.name).join('\n'),
            total: document.getElementById('totalPrice').innerText
        };

        fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(orderData) })
            .then(() => {
                alert('âœ… è¨‚å–®é€å‡ºæˆåŠŸï¼è«‹ç•™æ„è€é—†å«è™Ÿã€‚');
                cart = []; updateCart();
                document.getElementById('tableNum').value = '';
                sendBtn.disabled = false;
                sendBtn.innerText = 'ç¢ºèªé€å‡ºè¨‚å–®';
            })
            .catch(() => {
                alert('âŒ å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚');
                sendBtn.disabled = false;
            });
    }
</script>
</body>
</html>